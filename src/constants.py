"""Application constants.

アプリケーション全体で使用する定数を定義する。
他のモジュールへの依存がないため、どこからでも安全にインポートできる。
"""

# =============================================================================
# アプリケーション基本設定
# =============================================================================

# アプリケーション名
# pyproject.toml の name と一致させる
APP_NAME = "discord-util-bot"

# データベース名
# PostgreSQL はハイフンを含む識別子を許可しないため、アンダースコアに変換
DB_NAME = APP_NAME.replace("-", "_")

# テスト用データベース名
# 本番 DB と分離するために _test サフィックスを付与
TEST_DB_NAME = f"{DB_NAME}_test"

# =============================================================================
# データベース URL (デフォルト値)
# =============================================================================

# 開発環境用デフォルトデータベース URL
# Docker Compose で起動した PostgreSQL に接続する設定
# 本番環境では DATABASE_URL 環境変数で上書きする
DEFAULT_DATABASE_URL = f"postgresql+asyncpg://user:password@localhost/{DB_NAME}"

# テスト用データベース URL (非同期ドライバ: asyncpg)
# pytest 実行時に使用する。TEST_DATABASE_URL 環境変数で上書き可能
DEFAULT_TEST_DATABASE_URL = (
    f"postgresql+asyncpg://user:password@localhost/{TEST_DB_NAME}"
)

# テスト用データベース URL (同期ドライバ: psycopg2)
# 同期的な DB 操作が必要なテストで使用
DEFAULT_TEST_DATABASE_URL_SYNC = f"postgresql://user:password@localhost/{TEST_DB_NAME}"

# =============================================================================
# Web 管理画面: セッション設定
# =============================================================================

# セッション Cookie の有効期限 (秒)
# ユーザーがログイン後、この時間が経過するとセッションが無効になり再ログインが必要
# 24時間 = 60秒 × 60分 × 24時間 = 86400秒
SESSION_MAX_AGE_SECONDS = 60 * 60 * 24

# =============================================================================
# Web 管理画面: レート制限設定
# =============================================================================

# ログイン試行の最大回数
# この回数を超えると一定時間ログインがブロックされる (ブルートフォース対策)
LOGIN_MAX_ATTEMPTS = 5

# レート制限のウィンドウ期間 (秒)
# この期間内の失敗回数をカウントする。期間が過ぎると失敗回数がリセットされる
# 5分 = 300秒
LOGIN_WINDOW_SECONDS = 300

# レート制限エントリのクリーンアップ間隔 (秒)
# メモリリーク防止のため、古い IP アドレスのエントリを定期的に削除する
# 1時間 = 3600秒
RATE_LIMIT_CLEANUP_INTERVAL_SECONDS = 3600

# =============================================================================
# Web 管理画面: トークン設定
# =============================================================================

# パスワードリセットトークンの有効期限 (秒)
# 「パスワードを忘れた」機能で発行されるトークンの有効期間
# 1時間 = 3600秒
RESET_TOKEN_EXPIRY_SECONDS = 60 * 60

# メールアドレス変更確認トークンの有効期限 (秒)
# メールアドレス変更時に新しいアドレスに送信される確認リンクの有効期間
# 1時間 = 3600秒
EMAIL_CHANGE_TOKEN_EXPIRY_SECONDS = 60 * 60

# セキュリティトークン生成時のバイト長
# secrets.token_urlsafe() や secrets.token_hex() に渡す値
# 32バイト = 256ビットのエントロピー (十分なセキュリティ強度)
TOKEN_BYTE_LENGTH = 32

# =============================================================================
# Web 管理画面: パスワード設定
# =============================================================================

# bcrypt の最大パスワード長 (バイト)
# bcrypt 4.x は72バイトを超えるパスワードで ValueError を発生させる
# UTF-8 エンコード後のバイト数でチェックする必要がある
BCRYPT_MAX_PASSWORD_BYTES = 72

# パスワードの最小文字数
# セキュリティのため、短すぎるパスワードを拒否する
PASSWORD_MIN_LENGTH = 8

# =============================================================================
# メール送信設定
# =============================================================================

# SMTP 接続タイムアウト (秒)
# Linux 環境でハングアップを防止するため、適切なタイムアウトを設定
SMTP_TIMEOUT_SECONDS = 30

# SMTPS (SSL) ポート番号
# ポート 465 は SMTP over SSL (暗黙的 TLS) を使用
# ポート 587 は STARTTLS (明示的 TLS) を使用
SMTP_SSL_PORT = 465

# =============================================================================
# データベース接続設定
# =============================================================================

# デフォルトのコネクションプールサイズ
# Heroku の基本プラン (mini/basic) は最大20接続
# 安全マージンを取って小さめに設定
DEFAULT_DB_POOL_SIZE = 5

# デフォルトのオーバーフロー接続数
# プールが満杯の場合に追加で作成できる接続数
DEFAULT_DB_MAX_OVERFLOW = 10
